# 1. Connect to EC2
ssh -i genai-prod-key.pem ubuntu@16.171.253.178

# 2. Install Docker Engine
sudo apt install -y docker.io

3️⃣ Enable and start Docker
sudo systemctl enable docker
sudo systemctl start docker

4️⃣ Add ubuntu user to docker group
sudo usermod -aG docker ubuntu
newgrp docker
5️⃣ Verify Docker works
docker --version

6️⃣ Install Docker Compose
sudo apt install -y docker-compose

docker-compose --version



1️⃣ Install NGINX
sudo apt install nginx -y

2️⃣ Enable and start NGINX
sudo systemctl enable nginx
sudo systemctl start nginx

3️⃣ Check NGINX status
sudo systemctl status nginx

4️⃣ Open your EC2 Public IP in browser
http://YOUR_EC2_IP = You should see the default Nginx Welcome Page.


Clone your repo:
git clone <YOUR_GITHUB_REPO_URL>

Option A — Best: tree command (install once)
sudo apt install -y tree

tree -L 4

mv docker-compose.prod.yml docker-compose.yml

NGNIX folders

sudo mkdir -p /etc/letsencrypt
sudo mkdir -p /var/www/html
sudo chown -R www-data:www-data /var/www/html



1️⃣ Build and start all containers

docker-compose up -d --build

docker ps

curl http://localhost:8000/health
curl http://localhost:8501/


sudo apt update
sudo apt install -y certbot python3-certbot-nginx

version: "3.9"

services:

  backend:
    build:
      context: .
      dockerfile: src/backend/Dockerfile
    container_name: backend
    restart: always
    env_file:
      - ./src/backend/.env     # Astra DB, Google keys, JWT Secret, etc.
    networks:
      - app-net
    expose:
      - "8000"                 # backend must be exposed, NOT published
    depends_on:
      - frontend

  frontend:
    build:
      context: .
      dockerfile: src/frontend/Dockerfile
    container_name: frontend
    restart: always
    networks:
      - app-net
    expose:
      - "8501"
    environment:
      BACKEND_URL: "https://genaipoconline.online/api"   # IMPORTANT

  nginx:
    image: nginx:stable
    container_name: nginx
    restart: always
    depends_on:
      - backend
      - frontend
    networks:
      - app-net
    ports:
      - "80:80"          # HTTP
      - "443:443"        # HTTPS (Certbot will configure SSL)
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
      - /etc/letsencrypt:/etc/letsencrypt          # SSL certificates
      - /var/www/html:/var/www/html                # Certbot webroot

networks:
  app-net:
    driver: bridge
